<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>eSIMプラン詳細</title>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Zen Kaku Gothic New', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 100%;
    }
    .title {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
    }
    .price-top {
      text-align: center;
      margin-top: 10px;
      font-size: 20px;
      font-weight: bold;
    }
    .section {
      margin-top: 30px;
    }
    .section-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .list {
      margin: 5px 0 20px 20px;
      padding: 0;
    }
    .list li {
      margin-bottom: 5px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    select, input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }
    .total-price {
      font-weight: bold;
      text-align: center;
      font-size: 20px;
      margin: 20px 0;
    }
    .buy-btn {
      display: block;
      width: 100%;
      background-color: #00b050;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
    }
    .buy-btn:hover {
      background-color: #009043;
    }
  </style>
</head>
<body>

<div class="container">
  <div id="planName" class="title">読み込み中...</div>
  <div id="priceTop" class="price-top"></div>

  <div class="section">
    <p id="mainText"></p>

    <div class="section-title">■メリット</div>
    <ul id="meritList" class="list"></ul>

    <div class="section-title">■概要</div>
    <ul id="overviewList" class="list"></ul>

    <div class="section-title">■仕様</div>
    <ul id="specList" class="list"></ul>
  </div>

  <div class="section">
    <div class="form-group">
      <label for="days">利用日数を選択：</label>
      <select id="days"></select>
    </div>
    <div class="form-group">
      <label for="quantity">eSIMの数量を選択：</label>
      <input type="number" id="quantity" value="1" min="1" max="10">
    </div>
    <div id="totalPrice" class="total-price">合計金額：-</div>
    <a id="buyLink" class="buy-btn" target="_blank">このプランを購入する</a>
  </div>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const slug = urlParams.get('plan') || 'Japan'; // URLパラメータ(plan)から取得、なければJapan

const sheetUrls = {
  "Japan": "https://script.google.com/macros/s/AKfycbzgkH2liyopefSpyO3fDGoLA8rj3PL9UoVkqpjmPjyX9N80Wjjgzh3f6F8kQsZ4QByi/exec",
  // 他の国も追加していけます！
};

let planData = [];

async function fetchData() {
  if (!sheetUrls[slug]) {
    document.getElementById('planName').textContent = 'データが見つかりません';
    return;
  }
  const res = await fetch(sheetUrls[slug]);
  const data = await res.json();
  planData = data;
  init();
}

function init() {
  if (planData.length === 0) {
    document.getElementById('planName').textContent = 'データが見つかりません';
    return;
  }
  
  const firstRow = planData[0];
  document.getElementById('planName').textContent = firstRow["プラン名"] || firstRow["国"] + " eSIM";
  document.getElementById('mainText').textContent = firstRow["テキスト"] || "";

  const meritList = document.getElementById('meritList');
  ["メリット1", "メリット2", "メリット3"].forEach(key => {
    if (firstRow[key]) {
      const li = document.createElement('li');
      li.textContent = firstRow[key];
      meritList.appendChild(li);
    }
  });

  const overviewList = document.getElementById('overviewList');
  ["概要1", "概要2", "概要3"].forEach(key => {
    if (firstRow[key]) {
      const li = document.createElement('li');
      li.textContent = firstRow[key];
      overviewList.appendChild(li);
    }
  });

  const specList = document.getElementById('specList');
  ["仕様1", "仕様2", "仕様3"].forEach(key => {
    if (firstRow[key]) {
      const li = document.createElement('li');
      li.textContent = firstRow[key];
      specList.appendChild(li);
    }
  });

  const daysSelect = document.getElementById('days');
  planData.forEach(row => {
    const option = document.createElement('option');
    option.value = row["利用日数"];
    option.textContent = row["利用日数"];
    daysSelect.appendChild(option);
  });

  daysSelect.addEventListener('change', updatePrice);
  document.getElementById('quantity').addEventListener('input', updatePrice);

  updatePrice();
}

function updatePrice() {
  const day = document.getElementById('days').value;
  const qty = parseInt(document.getElementById('quantity').value, 10) || 1;
  const match = planData.find(row => row["利用日数"] === day);

  if (match) {
    const unitPrice = parseInt(match["金額"]);
    const total = unitPrice * qty;
    document.getElementById('priceTop').textContent = `金額：¥${unitPrice}`;
    document.getElementById('totalPrice').textContent = `合計金額：¥${total}`;
    document.getElementById('buyLink').href = match["URL"];
  } else {
    document.getElementById('totalPrice').textContent = "合計金額：-";
    document.getElementById('buyLink').href = "#";
  }
}

fetchData();
</script>

</body>
</html>
